<!doctype html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Shaikh Studio - Invoice</title>
  <style>
    :root{--accent:#1f8dd6;--muted:#666}
    body{font-family: Arial, sans-serif;margin:0;padding:20px;background:#f4f6f9;color:#111}
    .container{max-width:900px;margin:0 auto;background:#fff;padding:18px;border-radius:10px;box-shadow:0 6px 20px rgba(20,30,40,.08)}
    header{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-bottom:12px}
    .brand{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
    .logo{width:88px;height:88px;border-radius:8px;background:#eee;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .logo img{width:100%;height:100%;object-fit:contain}
    h1{margin:0;font-size:20px}
    .meta{text-align:left}
    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
    input[type=text], input[type=number], textarea{width:100%;padding:8px;border-radius:6px;border:1px solid #ddd;box-sizing:border-box}
    .row{display:flex;flex-wrap:wrap;gap:12px}
    .col{flex:1;min-width:200px}
    .controls{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}
    .btn{padding:9px 14px;border-radius:8px;border:0;cursor:pointer;font-weight:600}
    .btn-primary{background:var(--accent);color:#fff}
    .btn-ghost{background:#fff;border:1px solid #ddd}
    table{width:100%;border-collapse:collapse;margin-top:14px}
    th,td{padding:10px;border-bottom:1px solid #eee}
    th{background:#fafbfd;font-weight:700}
    tfoot td{font-weight:800}
    .right{text-align:right}
    .center{text-align:center}
    .left{text-align:left}
    .muted{color:var(--muted)}
    .small{font-size:13px}
    .table-wrapper{overflow-x:auto}
    @media print{
      body{background:transparent}
      .btn, .file-input, .controls{display:none}
      .container{box-shadow:none;border-radius:0;padding:0}
    }
    @media(max-width:600px){
      header{flex-direction:column;align-items:flex-start}
      .controls{flex-direction:column;align-items:stretch}
      .controls button, .controls input{width:100%}
      th, td{font-size:12px;padding:6px}
    }
  </style>
</head>
<body>
  <div class="container" id="invoiceWrap">
    <header>
      <div class="brand">
        <div class="logo" id="logoPreview">LOGO</div>
        <div>
          <h1 id="shopName">SHAIKH STUDIO</h1>
          <div class="muted small">Cloth Store</div>
        </div>
      </div>
      <div class="meta">
        <div class="small muted">Invoice #: <span id="invoiceNo">INV-001</span></div>
        <div class="small muted">Date: <span id="invoiceDate"></span></div>
      </div>
    </header>

    <section class="row" style="margin-bottom:8px">
      <div class="col">
        <label>Bill To (Customer Name)</label>
        <input type="text" id="customerName" placeholder="Customer name" />
      </div>
      <div class="col">
        <label>Phone</label>
        <input type="text" id="customerPhone" placeholder="03xx-xxxxxxx" />
      </div>
    </section>

    <section>
      <label>Items</label>
      <div class="table-wrapper">
        <table id="itemsTable">
          <thead>
            <tr>
              <th style="width:55%" class="left">Description</th>
              <th style="width:20%" class="center">Quantity</th>
              <th style="width:20%" class="center">Unit Price</th>
              <th style="width:15%" class="right">Total</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="itemsBody"></tbody>
          <tfoot>
            <tr>
              <td colspan="3" class="right">Subtotal</td>
              <td id="subTotal">0.00</td>
            </tr>
            <tr>
              <td colspan="3" class="right">Discount</td>
              <td><input type="number" id="discount" value="0" min="0" style="width:100px"/></td>
            </tr>
            <tr>
              <td colspan="3" class="right">Grand Total</td>
              <td id="grandTotal">0.00</td>
            </tr>
          </tfoot>
        </table>
      </div>

      <div class="controls">
        <button class="btn btn-primary" id="addItemBtn">Add Item</button>
        <button class="btn btn-ghost" id="printBtn">Print</button>
        <button class="btn btn-ghost" id="saveBtn">Save Invoice</button>
        <button class="btn btn-ghost" id="clearBtn">Clear</button>
        <input type="file" accept="image/*" id="logoInput" class="file-input"/>
        <input type="text" id="shopInput" placeholder="Shop name (SHAIKH STUDIO)" />
        <button class="btn" id="applyShop">Set</button>
      </div>

      <div style="margin-top:18px">
        <label>Remarks</label>
        <textarea id="remarks" rows="3"></textarea>
      </div>

      <div class="muted small" style="margin-top:12px">Generated by Shaikh Studio Invoice • Print for customer copy</div>
    </section>
  </div>

  <script>
    // --- basic functions & UI ---
    document.getElementById('invoiceDate').textContent = new Date().toLocaleDateString('en-GB');
    let invoiceCounter = 1;
    function format(num){ return Number(num||0).toFixed(2) }

    function addRow(desc='', qty=1, unit=0){
      const tbody = document.getElementById('itemsBody');
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td style="width:55%" class="left"><input type="text" class="item-desc" value="${desc}" /></td>
        <td style="width:20%" class="center"><input type="number" class="item-qty" value="${qty}" min="0" /></td>
        <td style="width:20%" class="center"><input type="number" class="item-unit" value="${unit}" min="0" step="0.01" /></td>
        <td class="right item-total">0.00</td>
        <td><button class="btn btn-ghost remove-row">×</button></td>
      `;
      tbody.appendChild(tr);
      attachRowEvents(tr);
      recalc();
    }

    function attachRowEvents(tr){
      tr.querySelectorAll('input').forEach(inp => inp.addEventListener('input', recalc));
      tr.querySelector('.remove-row').addEventListener('click', ()=>{
        tr.remove(); recalc();
      });
    }

    function recalc(){
      const rows = [...document.querySelectorAll('#itemsBody tr')];
      let subtotal = 0;
      rows.forEach(r=>{
        const q = Number(r.querySelector('.item-qty').value||0);
        const u = Number(r.querySelector('.item-unit').value||0);
        const rowAmount = q * u;
        subtotal += rowAmount;
        r.querySelector('.item-total').textContent = format(rowAmount);
      });
      document.getElementById('subTotal').textContent = format(subtotal);
      const discount = Number(document.getElementById('discount').value||0);
      const grand = subtotal - discount;
      document.getElementById('grandTotal').textContent = format(grand>=0?grand:0);
    }

    document.getElementById('addItemBtn').addEventListener('click', ()=> addRow('Cloth Item',1,120));
    document.getElementById('discount').addEventListener('input', recalc);
    document.getElementById('printBtn').addEventListener('click', ()=>{
      invoiceCounter++;
      document.getElementById('invoiceNo').textContent = 'INV-' + String(invoiceCounter).padStart(3,'0');
      window.print();
    });
    document.getElementById('clearBtn').addEventListener('click', ()=>{
      if(!confirm('Are you sure you want to clear the invoice?')) return;
      document.getElementById('customerName').value='';
      document.getElementById('customerPhone').value='';
      document.getElementById('itemsBody').innerHTML = '';
      document.getElementById('discount').value = 0;
      document.getElementById('remarks').value = '';
      document.getElementById('grandTotal').textContent = '0.00';
      recalc();
    });

    document.getElementById('logoInput').addEventListener('change', function(e){
      const file = e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = function(ev){
        const img = document.createElement('img'); img.src = ev.target.result;
        const logoWrap = document.getElementById('logoPreview');
        logoWrap.innerHTML = ''; logoWrap.appendChild(img);
      };
      reader.readAsDataURL(file);
    });

    document.getElementById('applyShop').addEventListener('click', ()=>{
      const name = document.getElementById('shopInput').value.trim();
      if(name) document.getElementById('shopName').textContent = name;
    });

    // --- Save Invoice as a complete static HTML snapshot ---
    document.getElementById('saveBtn').addEventListener('click', ()=>{
      // Collect header info
      const shopName = document.getElementById('shopName').textContent.trim();
      const invoiceNo = document.getElementById('invoiceNo').textContent.trim();
      const invoiceDate = document.getElementById('invoiceDate').textContent.trim();
      const customerName = document.getElementById('customerName').value.trim();
      const customerPhone = document.getElementById('customerPhone').value.trim();
      const remarks = document.getElementById('remarks').value.trim();
      const discount = Number(document.getElementById('discount').value||0);

      // Collect logo (if image uploaded use its src, otherwise show text)
      let logoHTML = document.getElementById('logoPreview').innerHTML;
      // If logo contains an <img>, keep it; otherwise render the text inside a div
      if(!/img/i.test(logoHTML)){
        // sanitize small text fallback
        const txt = document.getElementById('logoPreview').textContent.trim() || '';
        logoHTML = `<div style="width:88px;height:88px;border-radius:8px;background:#eee;display:flex;align-items:center;justify-content:center;font-weight:700">${escapeHtml(txt)}</div>`;
      }

      // Build items rows from current table
      const rows = [...document.querySelectorAll('#itemsBody tr')];
      let itemsRowsHTML = '';
      let subtotal = 0;
      rows.forEach(r=>{
        const desc = escapeHtml(r.querySelector('.item-desc').value || '');
        const qty = Number(r.querySelector('.item-qty').value||0);
        const unit = Number(r.querySelector('.item-unit').value||0);
        const total = qty * unit;
        subtotal += total;
        itemsRowsHTML += `
          <tr>
            <td class="left">${desc}</td>
            <td class="center">${qty}</td>
            <td class="center">${format(unit)}</td>
            <td class="right">${format(total)}</td>
          </tr>
        `;
      });

      const grand = Math.max(subtotal - discount, 0);

      // Full HTML content for the saved file (styles inlined so it looks the same)
      const savedHTML = `<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Invoice - ${escapeHtml(invoiceNo)}</title>
<style>
:root{--accent:#1f8dd6;--muted:#666}
body{font-family: Arial, sans-serif;margin:0;padding:20px;background:#f4f6f9;color:#111}
.container{max-width:900px;margin:0 auto;background:#fff;padding:18px;border-radius:10px;box-shadow:0 6px 20px rgba(20,30,40,.08)}
header{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-bottom:12px}
.brand{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
.logo{width:88px;height:88px;border-radius:8px;background:#eee;display:flex;align-items:center;justify-content:center;overflow:hidden}
.logo img{width:100%;height:100%;object-fit:contain}
h1{margin:0;font-size:20px}
.meta{text-align:left}
label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
.table-wrapper{overflow-x:auto}
table{width:100%;border-collapse:collapse;margin-top:14px}
th,td{padding:10px;border-bottom:1px solid #eee}
th{background:#fafbfd;font-weight:700}
tfoot td{font-weight:800}
.right{text-align:right}
.center{text-align:center}
.left{text-align:left}
.muted{color:var(--muted)}
.small{font-size:13px}
@media print{ body{background:transparent} .container{box-shadow:none;border-radius:0;padding:0} }
</style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">${logoHTML}</div>
        <div>
          <h1>${escapeHtml(shopName)}</h1>
          <div class="muted small">Cloth Store</div>
        </div>
      </div>
      <div class="meta">
        <div class="small muted">Invoice #: ${escapeHtml(invoiceNo)}</div>
        <div class="small muted">Date: ${escapeHtml(invoiceDate)}</div>
      </div>
    </header>

    <section class="row" style="margin-bottom:8px">
      <div class="col">
        <label>Bill To (Customer Name)</label>
        <div>${escapeHtml(customerName)}</div>
      </div>
      <div class="col">
        <label>Phone</label>
        <div>${escapeHtml(customerPhone)}</div>
      </div>
    </section>

    <section>
      <label>Items</label>
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th class="left">Description</th>
              <th class="center">Quantity</th>
              <th class="center">Unit Price</th>
              <th class="right">Total</th>
            </tr>
          </thead>
          <tbody>
            ${itemsRowsHTML || `<tr><td colspan="4" class="center muted small">No items</td></tr>`}
          </tbody>
          <tfoot>
            <tr>
              <td colspan="3" class="right">Subtotal</td>
              <td class="right">${format(subtotal)}</td>
            </tr>
            <tr>
              <td colspan="3" class="right">Discount</td>
              <td class="right">${format(discount)}</td>
            </tr>
            <tr>
              <td colspan="3" class="right">Grand Total</td>
              <td class="right">${format(grand)}</td>
            </tr>
          </tfoot>
        </table>
      </div>

      <div style="margin-top:18px">
        <label>Remarks</label>
        <div>${escapeHtml(remarks)}</div>
      </div>

      <div class="muted small" style="margin-top:12px">Generated by Shaikh Studio Invoice • Customer copy</div>
    </section>
  </div>
</body>
</html>`;

      // Create blob + download
      const blob = new Blob([savedHTML], {type: 'text/html'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `Invoice-${invoiceNo.replace(/\s+/g,'_')}.html`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });

    // small helper to escape HTML content
    function escapeHtml(str){
      if(!str) return '';
      return String(str)
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'",'&#39;');
    }

    // initial demo row
    addRow('Cloth',1,500);
    document.addEventListener('keydown', (e)=>{ if(e.ctrlKey && e.key==='Enter') addRow(); });
    recalc();
  </script>
</body>
</html>